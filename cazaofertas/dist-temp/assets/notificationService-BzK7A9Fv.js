import{X as o,O as c}from"./index-BlDEwxQf.js";const l={async createNotification({userId:a,type:e,title:t,message:i,data:s={}}){try{const{data:n}=await c.from("preferencias_notificaciones").select("*").eq("user_id",a).single();if(s.category_id&&(n!=null&&n.category_preferences)&&n.category_preferences[s.category_id]===!1)return null;const{data:d,error:r}=await c.from("notificaciones").insert({user_id:a,type:e,title:t,message:i,data:s,read:!1}).select().single();if(r)throw r;return d}catch(n){return console.error("Error al crear notificación:",n),null}},async notifyOfferCreated(a,e){return this.createNotification({userId:a,type:o.OFFER,title:"¡Oferta publicada con éxito!",message:`Tu oferta "${e.title}" ha sido publicada y está disponible para todos los usuarios.`,data:{offer_id:e.id}})},async notifyOfferApproved(a,e){return this.createNotification({userId:a,type:o.OFFER,title:"Oferta aprobada",message:`Tu oferta "${e.title}" ha sido revisada y aprobada.`,data:{offer_id:e.id}})},async notifyOfferRejected(a,e,t){return this.createNotification({userId:a,type:o.OFFER,title:"Oferta rechazada",message:`Tu oferta "${e.title}" no ha sido aprobada. Motivo: ${t||"No cumple con nuestras políticas"}`,data:{offer_id:e.id}})},async notifyPriceDropOnWishlist(a,e,t,i){const s=Math.round((t-i)/t*100);return this.createNotification({userId:a,type:o.PRICE_DROP,title:"¡Bajada de precio!",message:`El producto "${e.title}" de tu lista de deseos ahora está un ${s}% más barato.`,data:{product_id:e.id,old_price:t,new_price:i}})},async notifyOrderCreated(a,e){return this.createNotification({userId:a,type:o.ORDER,title:"Pedido realizado",message:`Tu pedido #${e.id} ha sido recibido con éxito. Total: ${e.total}€`,data:{order_id:e.id}})},async notifyOrderStatusUpdate(a,e,t){const i={processing:"está siendo procesado.",shipped:"ha sido enviado.",delivered:"ha sido entregado.",cancelled:"ha sido cancelado."},s=i[t]?`Tu pedido #${e.id} ${i[t]}`:`El estado de tu pedido #${e.id} ha cambiado a: ${t}.`;return this.createNotification({userId:a,type:o.ORDER,title:"Actualización de pedido",message:s,data:{order_id:e.id,status:t}})},async notifyPaymentConfirmed(a,e){return this.createNotification({userId:a,type:o.PAYMENT,title:"Pago confirmado",message:`El pago de tu pedido #${e.id} por ${e.total}€ ha sido confirmado.`,data:{order_id:e.id}})},async notifyPaymentFailed(a,e,t){return this.createNotification({userId:a,type:o.PAYMENT,title:"Problema con el pago",message:`Ha habido un problema con el pago de tu pedido #${e.id}. Motivo: ${t||"Error en el proceso de pago"}`,data:{order_id:e.id}})},async notifyTicketCreated(a,e){return this.createNotification({userId:a,type:o.TICKET,title:"Ticket de soporte creado",message:`Tu ticket de soporte #${e.id} "${e.subject}" ha sido creado.`,data:{ticket_id:e.id}})},async notifyTicketResponse(a,e,t=!0){return this.createNotification({userId:a,type:o.TICKET,title:"Respuesta a tu ticket",message:t?`Un agente de soporte ha respondido a tu ticket #${e.id}.`:`Hay una nueva respuesta en tu ticket de soporte #${e.id}.`,data:{ticket_id:e.id}})},async notifyTicketResolved(a,e){return this.createNotification({userId:a,type:o.TICKET,title:"Ticket resuelto",message:`Tu ticket de soporte #${e.id} ha sido marcado como resuelto.`,data:{ticket_id:e.id}})},async notifyNewStoreOffers(a,e,t){return this.createNotification({userId:a,type:o.STORE,title:`Nuevas ofertas en ${e.name}`,message:`Hay ${t} nueva${t!==1?"s":""} oferta${t!==1?"s":""} de ${e.name} que podrían interesarte.`,data:{store_id:e.id,store_name:e.name}})},async notifyNewCategoryOffers(a,e,t){return this.createNotification({userId:a,type:o.CATEGORY,title:`Nuevas ofertas en ${e.name}`,message:`Se han añadido ${t} nueva${t!==1?"s":""} oferta${t!==1?"s":""} en la categoría ${e.name}.`,data:{category_id:e.id,category_slug:e.slug,category_name:e.name}})},async notifyPersonalizedRecommendation(a,e){return this.createNotification({userId:a,type:o.RECOMMENDATION,title:"Recomendación personalizada",message:`Basado en tus intereses: "${e.title}" - ${e.description}`,data:{url:e.url,recommendation_id:e.id}})},async notifyWishlistUpdated(a,e,t){return this.createNotification({userId:a,type:o.WISHLIST,title:"Lista de deseos actualizada",message:`El producto "${e}" ha sido ${t==="add"?"añadido a":"eliminado de"} tu lista de deseos.`,data:{}})},async notifyContactResponse(a,e){return this.createNotification({userId:a,type:o.CONTACT,title:"Respuesta a tu consulta",message:`Hemos respondido a tu consulta "${e}". Revisa tu correo electrónico.`,data:{}})},async notifySystemMaintenance(a,e,t){return this.createNotification({userId:a,type:o.SYSTEM,title:"Mantenimiento programado",message:`CazaOfertas estará en mantenimiento el ${new Date(e).toLocaleString()} durante aproximadamente ${t} minutos.`,data:{maintenance_start:e,maintenance_duration:t}})},async notifyAccountActivity(a,e,t){return this.createNotification({userId:a,type:o.SYSTEM,title:"Actividad en tu cuenta",message:`Se ha detectado un ${e} desde ${t}. Si no has sido tú, por favor contacta con soporte.`,data:{activity_type:e,location:t}})},async sendBatchNotification(a,e,t,i,s={}){if(!Array.isArray(a)||a.length===0)return[];try{const n=a.map(u=>({user_id:u,type:e,title:t,message:i,data:s,read:!1})),{data:d,error:r}=await c.from("notificaciones").insert(n).select();if(r)throw r;return d}catch(n){return console.error("Error al enviar notificaciones por lotes:",n),[]}},async notifySupportTicketCreated(a,e,t,i){return this.createNotification({userId:a,type:"SUPPORT_TICKET_CREATED",title:"Ticket de soporte creado",message:`Tu ticket "${t}" ha sido creado y será revisado en breve.`,data:{ticket_id:e,ticket_subject:t,priority:i}})},async notifySupportTicketStatusChanged(a,e,t,i){const n={en_proceso:"Tu ticket de soporte está siendo revisado por nuestro equipo.",esperando_respuesta:"Hemos respondido a tu ticket de soporte y esperamos tu respuesta.",resuelto:"Tu ticket de soporte ha sido resuelto. Si persiste el problema, puedes reabrirlo.",cerrado:"Tu ticket de soporte ha sido cerrado."}[i]||`El estado de tu ticket "${t}" ha cambiado a ${i}.`;return this.createNotification({userId:a,type:"SUPPORT_TICKET_STATUS_CHANGED",title:"Actualización de estado de ticket",message:n,data:{ticket_id:e,ticket_subject:t,status:i}})},async notifySupportTicketResponse(a,e,t,i){return this.createNotification({userId:a,type:"SUPPORT_TICKET_RESPONSE",title:"Nueva respuesta en tu ticket",message:`${i} ha respondido a tu ticket "${t}".`,data:{ticket_id:e,ticket_subject:t}})},async notifyWishlistUpdated(a,e,t){const s={add:`${e} se ha añadido a tu lista de deseos.`,remove:`${e} se ha eliminado de tu lista de deseos.`}[t]||`Tu lista de deseos ha sido actualizada con ${e}.`;return this.createNotification({userId:a,type:"WISHLIST_UPDATED",title:"Lista de deseos actualizada",message:s,data:{product_name:e,action:t}})},async notifyOrderStatusChanged(a,e,t,i){const n={pendiente:"Tu pedido está pendiente de confirmación.",procesando:"Tu pedido está siendo procesado.",enviado:"Tu pedido ha sido enviado.",entregado:"Tu pedido ha sido entregado.",cancelado:"Tu pedido ha sido cancelado."}[i]||`El estado de tu pedido ${t} ha cambiado a: ${i}.`;return this.createNotification({userId:a,type:"ORDER_STATUS_CHANGED",title:"Actualización de estado de pedido",message:n,data:{order_id:e,order_ref:t,status:i}})},async notifyOrderShipped(a,e,t,i){return this.createNotification({userId:a,type:"ORDER_SHIPPED",title:"Pedido enviado",message:`Tu pedido ${t} ha sido enviado y está en camino.`,data:{order_id:e,order_ref:t,tracking_info:i}})},async notifyOrderDelivered(a,e,t){return this.createNotification({userId:a,type:"ORDER_DELIVERED",title:"Pedido entregado",message:`Tu pedido ${t} ha sido entregado. ¡Esperamos que disfrutes tu compra!`,data:{order_id:e,order_ref:t}})},async notifyRecommendedOffers(a,e){const t=e.length;let i;return t===1?i=`Hay una nueva oferta recomendada para ti: ${e[0].title}`:i=`Hay ${t} nuevas ofertas recomendadas para ti.`,this.createNotification({userId:a,type:"RECOMMENDED_OFFERS",title:"Ofertas recomendadas para ti",message:i,data:{offers:e.map(s=>({id:s.id,title:s.title,price:s.price}))}})},async notifyThreadReply(a,e,t,i){return this.createNotification({userId:a,type:o.FORUM_THREAD_REPLY,title:"Nuevo mensaje en tu tema",message:`${i} ha respondido a tu tema "${t}".`,data:{thread_id:e,thread_title:t,reply_user:i}})},async notifyThreadMention(a,e,t,i){return this.createNotification({userId:a,type:o.FORUM_THREAD_MENTION,title:"Te han mencionado en un tema",message:`${i} te ha mencionado en el tema "${t}".`,data:{thread_id:e,thread_title:t,mention_user:i}})},async notifyThreadLiked(a,e,t,i){return this.createNotification({userId:a,type:o.FORUM_THREAD_LIKED,title:"A alguien le gustó tu tema",message:`A ${i} le gustó tu tema "${t}".`,data:{thread_id:e,thread_title:t,like_user:i}})},async notifyCommentReply(a,e,t,i){return this.createNotification({userId:a,type:o.COMMENT_REPLY,title:"Respuesta a tu comentario",message:`${i} ha respondido a tu comentario en "${t}".`,data:{product_id:e,product_name:t,reply_user:i}})},async notifyCommentMention(a,e,t,i){return this.createNotification({userId:a,type:o.COMMENT_MENTION,title:"Te han mencionado en un comentario",message:`${i} te ha mencionado en un comentario sobre "${t}".`,data:{product_id:e,product_name:t,mention_user:i}})},async notifyCommentLiked(a,e,t,i){return this.createNotification({userId:a,type:o.COMMENT_LIKED,title:"A alguien le gustó tu comentario",message:`A ${i} le gustó tu comentario en "${t}".`,data:{product_id:e,product_name:t,like_user:i}})}};export{l as N};
