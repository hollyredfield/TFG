import{j as e}from"./ui-BJ93jQot.js";import{a as o,L as S,i as de,f as le}from"./vendor-TA_wDYrC.js";import{u as G,M as ce,ao as U,d as $,L as J,ap as ue,aq as me,V as i,ar as xe,D as ge,o as he,Z as pe,af as be,l as z,as as ye,at as fe,au as je,av as Ne,aw as ve,ax as L,ay as we,az as ke}from"./index-BlDEwxQf.js";import{N as Q}from"./notificationService-BzK7A9Fv.js";import{S as W}from"./StarRating-DMe66NK6.js";import{C as Se}from"./CommentSystem-2xyxn-SR.js";import{I as Ce}from"./ImageWithFallback-BgI07kEf.js";import"react-toastify";import"./VoteSystem-C-S41ZoI.js";import"./forumService-DXNLY8bn.js";import"./mockData-0ElwO_P3.js";import"./es-tLztjAZs.js";const _e=({productId:h,productName:C,onClose:s})=>{const{user:f}=G(),[E,r]=o.useState(!0),[g,y]=o.useState("welcome"),[A,R]=o.useState([]),[j,x]=o.useState(""),[T,F]=o.useState(!1),[_,m]=o.useState(!1);o.useEffect(()=>{async function d(){try{const{data:l,success:w}=await ue("productos");w&&l&&R(l.slice(0,4))}catch(l){console.error("Error cargando FAQs para el chat:",l)}}d(),setTimeout(()=>{m(!0)},100)},[]);const N=()=>{m(!1),setTimeout(()=>{r(!1),s()},300)},v=async d=>{if(d.preventDefault(),!!j.trim()){F(!0);try{f?await me({userId:f.id,subject:`Pregunta sobre producto: ${C||"Producto #"+h}`,message:j,department:"productos",priority:"normal"}):await new Promise(l=>setTimeout(l,800)),y("success")}catch(l){console.error("Error enviando pregunta:",l),i.error("No se pudo enviar tu pregunta. Inténtalo de nuevo.")}finally{F(!1)}}};return E?e.jsxs("div",{className:`fixed bottom-5 right-5 z-50 w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden transition-all duration-300 transform ${_?"translate-y-0 opacity-100":"translate-y-10 opacity-0"}`,children:[e.jsxs("div",{className:"bg-primary text-white p-4 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-medium",children:[g==="welcome"&&"¿Necesitas ayuda?",g==="faqs"&&"Preguntas frecuentes",g==="question"&&"Haz tu pregunta",g==="success"&&"¡Pregunta enviada!"]}),e.jsx("button",{onClick:N,className:"text-white hover:text-gray-200 focus:outline-none",children:e.jsx(ce,{})})]}),e.jsxs("div",{className:"p-4 max-h-96 overflow-y-auto",children:[g==="welcome"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["¿Tienes alguna duda sobre ",C||"este producto","?"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>y("faqs"),className:"w-full py-2 px-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 flex justify-between items-center transition-colors",children:[e.jsx("span",{children:"Ver preguntas frecuentes"}),e.jsx(U,{})]}),e.jsxs("button",{onClick:()=>y("question"),className:"w-full py-2 px-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 flex justify-between items-center transition-colors",children:[e.jsx("span",{children:"Hacer una pregunta"}),e.jsx($,{})]}),e.jsxs(S,{to:`/soporte?ref=product&id=${h}`,className:"w-full py-2 px-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 flex justify-between items-center transition-colors",children:[e.jsx("span",{children:"Ir al soporte completo"}),e.jsx($,{})]})]})]}),g==="faqs"&&e.jsxs(e.Fragment,{children:[A.length>0?e.jsx("div",{className:"space-y-4",children:A.map((d,l)=>e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4 last:border-b-0 last:pb-0",children:[e.jsx("h4",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:d.pregunta}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:d.respuesta.length>150?d.respuesta.substring(0,150)+"...":d.respuesta}),e.jsx(S,{to:"/preguntas-frecuentes",className:"text-primary dark:text-primary-light text-sm inline-block mt-2",children:"Leer más"})]},l))}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No se encontraron preguntas frecuentes para este producto."}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>y("welcome"),className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 text-sm",children:"Volver"}),e.jsxs("button",{onClick:()=>y("question"),className:"text-primary dark:text-primary-light flex items-center text-sm",children:["Hacer una pregunta ",e.jsx($,{className:"ml-1"})]})]})]}),g==="question"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:f?"Escribe tu pregunta y te responderemos lo antes posible.":"Escribe tu pregunta. Necesitarás iniciar sesión para recibir nuestra respuesta."}),e.jsxs("form",{onSubmit:v,children:[e.jsx("textarea",{value:j,onChange:d=>x(d.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-3 text-gray-800 dark:text-white bg-white dark:bg-gray-700 focus:border-primary focus:ring-primary mb-4 min-h-[100px]",placeholder:"Tu pregunta...",required:!0}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"button",onClick:()=>y("welcome"),className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 text-sm",children:"Volver"}),e.jsx("button",{type:"submit",disabled:T||!j.trim(),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:bg-primary/50 disabled:cursor-not-allowed flex items-center",children:T?"Enviando...":"Enviar pregunta"})]})]})]}),g==="success"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"¡Gracias por tu pregunta!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:f?"Te responderemos lo antes posible en la sección de soporte.":"Para recibir nuestra respuesta, inicia sesión o regístrate."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cerrar"}),!f&&e.jsx(S,{to:"/login",className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark",children:"Iniciar sesión"})]})]})]})]}):null},Pe=({onClick:h,productInCart:C=!1})=>e.jsx("button",{onClick:h,className:"fixed bottom-5 right-5 z-40 bg-primary hover:bg-primary-dark text-white p-3 rounded-full shadow-lg flex items-center justify-center transition-all transform hover:scale-105","aria-label":"Abrir chat de ayuda",children:C?e.jsx(J,{size:24}):e.jsx(U,{size:24})}),Ue=()=>{const{productId:h}=de(),C=le(),{user:s}=G(),{addItem:f}=xe(),{createNotification:E}=ge(),[r,g]=o.useState(null),[y,A]=o.useState(!0),[R,j]=o.useState(null),[x,T]=o.useState([]),[F,_]=o.useState(!1),[m,N]=o.useState({title:"",rating:5,comment:""}),[v,d]=o.useState(!1),[l,w]=o.useState(null),[H,q]=o.useState(!1),[K,Z]=o.useState([]),[P,V]=o.useState(!1),[D,M]=o.useState(!1),[p,B]=o.useState(0),[X,O]=o.useState(!1);o.useEffect(()=>{async function a(){A(!0),j(null);try{const{data:t,success:n,error:c}=await je(h);if(!n||!t)throw new Error((c==null?void 0:c.message)||"No se pudo cargar el producto");g(t),console.log("ESTRUCTURA DEL PRODUCTO:",JSON.stringify(t,null,2));const u=await Ne(h);if(u.success&&T(u.data||[]),s){const{isSaved:b,savedId:I,alertSettings:k}=await ve(s.id,h);d(b),w(I),k&&(V(k.priceAlert||!1),M(k.stockAlert||!1),k.priceThreshold&&B(k.priceThreshold))}Z([])}catch(t){console.error("Error loading product details:",t),j("No se pudo cargar el detalle del producto"),i.error("Error al cargar el producto")}finally{A(!1)}}a()},[h,s]);const Y=()=>{r&&(f({id:r.id,name:r.nombre,price:r.precio_actual||r.precio,image:r.imagen_url,quantity:1}),i.success("Producto añadido al carrito"))},ee=async()=>{var a;if(!s){i.error("Debes iniciar sesión para guardar productos");return}try{if(v){const{error:t}=await we(l);if(t)throw t;d(!1),w(null),i.success("Producto eliminado de guardados"),await Q.notifyWishlistUpdated(s.id,r.nombre,"remove")}else{const{data:t,error:n}=await L(s.id,r.id);if(n)throw n;d(!0),w((a=t==null?void 0:t[0])==null?void 0:a.id),i.success("Producto guardado"),await Q.notifyWishlistUpdated(s.id,r.nombre,"add")}}catch(t){console.error("Error al guardar/eliminar producto:",t),i.error("Error al guardar/eliminar producto")}},re=async()=>{var a;if(!s){i.error("Debes iniciar sesión para configurar alertas");return}try{let t=l;if(!v){const{data:u,error:b}=await L(s.id,r.id);if(b)throw b;d(!0),t=(a=u==null?void 0:u[0])==null?void 0:a.id,w(t),i.success("Producto guardado")}const n=!P,{error:c}=await supabase.from("productos_guardados").update({price_alert:n,price_threshold:p,updated_at:new Date().toISOString()}).eq("id",t);if(c)throw c;V(n),n?(await E({userId:s.id,type:"PRICE_DROP",title:"Alerta de precio configurada",message:`Te notificaremos cuando ${r.nombre} baje a ${p}€ o menos.`,data:{product_id:r.id,threshold:p}}),i.success(`Te avisaremos cuando el precio baje a ${p}€`)):i.success("Alerta de precio desactivada")}catch(t){console.error("Error al configurar alerta de precio:",t),i.error("Error al configurar alerta de precio")}},ae=async()=>{var a;if(!s){i.error("Debes iniciar sesión para configurar alertas");return}try{let t=l;if(!v){const{data:u,error:b}=await L(s.id,r.id);if(b)throw b;d(!0),t=(a=u==null?void 0:u[0])==null?void 0:a.id,w(t),i.success("Producto guardado")}const n=!D,{error:c}=await supabase.from("productos_guardados").update({stock_alert:n,updated_at:new Date().toISOString()}).eq("id",t);if(c)throw c;M(n),n?(await E({userId:s.id,type:"STOCK_ALERT",title:"Alerta de disponibilidad configurada",message:`Te notificaremos cuando ${r.nombre} vuelva a estar disponible.`,data:{product_id:r.id}}),i.success("Te avisaremos cuando el producto vuelva a estar disponible")):i.success("Alerta de disponibilidad desactivada")}catch(t){console.error("Error al configurar alerta de disponibilidad:",t),i.error("Error al configurar alerta de disponibilidad")}},te=a=>{B(parseFloat(a.target.value))},se=async()=>{if(!(!s||!l))try{const{error:a}=await supabase.from("productos_guardados").update({price_threshold:p,updated_at:new Date().toISOString()}).eq("id",l);if(a)throw a;O(!1),i.success("Umbral de precio actualizado"),P&&await E({userId:s.id,type:"PRICE_DROP",title:"Umbral de alerta actualizado",message:`Te notificaremos cuando ${r.nombre} baje a ${p}€ o menos.`,data:{product_id:r.id,threshold:p}})}catch(a){console.error("Error al actualizar umbral de precio:",a),i.error("Error al actualizar umbral")}},ie=async a=>{var t,n;if(a.preventDefault(),!s){i.error("Debes iniciar sesión para añadir una reseña");return}try{const c={productId:r.id,userId:s.id,title:m.title||"Reseña",rating:m.rating,comment:m.comment},{success:u,data:b,error:I}=await ke(c);if(!u)throw new Error((I==null?void 0:I.message)||"Error al añadir reseña");const k={...b,perfiles_usuario:{nombre_usuario:((t=s.user_metadata)==null?void 0:t.nombre_usuario)||"Usuario",avatar_url:((n=s.user_metadata)==null?void 0:n.avatar_url)||null}};T([k,...x]),N({title:"",rating:5,comment:""}),_(!1),i.success("Reseña añadida con éxito")}catch(c){console.error("Error al añadir reseña:",c),i.error("Error al añadir reseña")}},oe=()=>{navigator.clipboard.writeText(window.location.href),i.success("Enlace copiado al portapapeles")},ne=()=>!x||x.length===0?0:(x.reduce((t,n)=>t+n.puntuacion,0)/x.length).toFixed(1);return y?e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8 flex justify-center",children:e.jsx("div",{className:"animate-spin h-10 w-10 border-3 border-primary rounded-full border-t-transparent"})}):R||!r?e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(he,{className:"h-5 w-5 mr-2 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{children:R||"No se pudo cargar el producto"})})]})}),e.jsx("button",{onClick:()=>C(-1),className:"button-modern button-secondary inline-flex items-center",children:"Volver"})]}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2 text-sm breadcrumbs",children:[e.jsx(S,{to:"/",className:"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary-light",children:"Inicio"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500 mx-1",children:"/"}),r.categorias&&e.jsxs(e.Fragment,{children:[e.jsx(S,{to:`/categoria/${r.categorias.slug}`,className:"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary-light",children:r.categorias.nombre}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500 mx-1",children:"/"})]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r.nombre})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 p-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full h-80 md:h-96 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden",children:[e.jsx(Ce,{src:r.imagen_url||r.url_imagen,alt:r.nombre||r.titulo||"Imagen del producto",categoryId:r.categoria_id||r.categoria&&r.categoria.id||r.categoria,storeName:r.tienda||r.store_name||"",product:r,className:"w-full h-full object-contain",style:{padding:"16px"}}),(r.descuento>0||r.porcentaje_descuento>0)&&e.jsxs("div",{className:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-md",children:["-",r.descuento||r.porcentaje_descuento,"%"]})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:r.nombre}),"            ",e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(W,{rating:ne()}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-2",children:["(",x.length," ",x.length===1?"reseña":"reseñas",")"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[(r.precio_actual||r.precio).toFixed(2),"€"]}),r.precio_original&&r.precio_actual<r.precio_original&&e.jsxs("span",{className:"ml-2 line-through text-gray-500 dark:text-gray-400",children:[r.precio_original.toFixed(2),"€"]}),r.stock>0?e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400",children:"En stock"}):e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-400",children:"Agotado"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Descripción"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:r.descripcion||"No hay descripción disponible para este producto."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 text-sm",children:[r.marca&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 dark:text-gray-400",children:"Marca"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.marca})]}),r.modelo&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 dark:text-gray-400",children:"Modelo"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.modelo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 dark:text-gray-400",children:"Categoría"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r.categorias?r.categorias.nombre:"Sin categoría"})]}),r.tiendas&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"block text-gray-500 dark:text-gray-400 mr-1",children:"Tienda"}),e.jsx(S,{to:`/tienda/${r.tiendas.slug}`,className:"font-medium text-primary dark:text-primary-light hover:underline",children:r.tiendas.nombre})]})]}),"            ",e.jsxs("div",{className:"flex flex-wrap gap-3 mt-auto",children:[e.jsxs("button",{onClick:Y,disabled:r.stock<=0,className:`button-modern button-primary flex-1 flex items-center justify-center ${r.stock<=0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(J,{className:"mr-2"}),"Añadir al carrito"]}),e.jsx("button",{onClick:ee,className:"button-modern button-secondary w-12 flex items-center justify-center",title:v?"Quitar de guardados":"Guardar producto",children:v?e.jsx(pe,{className:"text-red-500"}):e.jsx(be,{})}),e.jsx("button",{onClick:re,className:`button-modern ${P?"bg-green-600 hover:bg-green-700 text-white":"button-secondary"} w-12 flex items-center justify-center`,title:P?"Desactivar alerta de precio":"Activar alerta de bajada de precio",children:e.jsx(z,{className:P?"text-white":""})}),P&&e.jsxs("button",{onClick:()=>O(!0),className:"button-modern bg-blue-600 hover:bg-blue-700 text-white text-xs",title:"Configurar precio objetivo",children:["Precio: ",p,"€"]}),r.stock<=0&&e.jsx("button",{onClick:ae,className:`button-modern ${D?"bg-green-600 hover:bg-green-700 text-white":"button-secondary"} w-12 flex items-center justify-center`,title:D?"Desactivar alerta de disponibilidad":"Notificarme cuando esté disponible",children:e.jsx(z,{className:D?"text-white":""})}),e.jsx("button",{onClick:oe,className:"button-modern button-secondary w-12 flex items-center justify-center",title:"Compartir producto",children:e.jsx(ye,{})}),e.jsxs("button",{onClick:()=>q(!0),className:"button-modern button-secondary flex items-center justify-center",title:"Hacer una pregunta sobre este producto",children:[e.jsx(U,{className:"mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Preguntar"})]})]})]})]})}),e.jsxs("div",{className:"mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Reseñas"}),s&&!F&&e.jsx("button",{onClick:()=>_(!0),className:"button-modern button-secondary",children:"Escribir reseña"})]}),F&&e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/30",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Añadir reseña"}),e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"rating",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Puntuación"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>N({...m,rating:a}),className:"text-2xl focus:outline-none",children:a<=m.rating?e.jsx(FaStar,{className:"text-yellow-400"}):e.jsx(FaRegStar,{className:"text-yellow-400"})},a))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Título"}),e.jsx("input",{type:"text",id:"title",value:m.title,onChange:a=>N({...m,title:a.target.value}),placeholder:"Resumen de tu opinión",className:"w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Comentario"}),e.jsx("textarea",{id:"comment",rows:"4",value:m.comment,onChange:a=>N({...m,comment:a.target.value}),placeholder:"Comparte tu experiencia con este producto",className:"w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 dark:bg-gray-700 dark:text-white",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>_(!1),className:"button-modern button-secondary",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"button-modern button-primary",children:"Publicar reseña"})]})]})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.length>0?x.map(a=>{var t,n,c,u;return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-3 flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700",children:(t=a.perfiles_usuario)!=null&&t.avatar_url?e.jsx("img",{src:a.perfiles_usuario.avatar_url,alt:a.perfiles_usuario.nombre_usuario,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:((c=(n=a.perfiles_usuario)==null?void 0:n.nombre_usuario)==null?void 0:c.charAt(0).toUpperCase())||"U"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:((u=a.perfiles_usuario)==null?void 0:u.nombre_usuario)||"Usuario Anónimo"}),e.jsxs("div",{className:"flex items-center",children:["                        ",e.jsx(W,{rating:a.puntuacion,size:"sm"}),e.jsx("time",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(a.created_at).toLocaleDateString()})]})]})]})}),a.titulo&&e.jsx("h5",{className:"font-medium text-gray-900 dark:text-white mt-3 mb-1",children:a.titulo}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line",children:a.comentario})]},a.id)}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-gray-300 dark:text-gray-600 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Todavía no hay reseñas"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Sé el primero en valorar este producto"}),s?e.jsx("button",{onClick:()=>_(!0),className:"mt-4 button-modern button-secondary",children:"Escribir una reseña"}):e.jsx(S,{to:"/login",className:"mt-4 button-modern button-secondary inline-block",children:"Iniciar sesión para escribir una reseña"})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Comentarios"}),e.jsx(Se,{productId:r==null?void 0:r.id,productType:"product"})]}),K.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Productos similares"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"})]}),H&&e.jsx(_e,{productId:r.id,productName:r.nombre,onClose:()=>q(!1)}),!H&&e.jsx(Pe,{onClick:()=>q(!0)}),X&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/70",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full border border-gray-700",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(z,{className:"text-primary mr-2"}),"Configurar alerta de precio"]}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Te notificaremos cuando el precio de este producto baje del valor especificado."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"priceThreshold",className:"block text-gray-300 mb-2",children:"Precio objetivo (€)"}),e.jsx("input",{type:"number",id:"priceThreshold",min:"0",step:"0.01",value:p,onChange:te,className:"w-full bg-gray-700 text-white border border-gray-600 rounded-md py-2 px-3 focus:outline-none focus:border-indigo-500"}),r&&e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Precio actual: ",r.precio_actual||r.precio,"€",r.precio_anterior&&e.jsxs("span",{className:"ml-2",children:["(Antes: ",e.jsxs("span",{className:"line-through",children:[r.precio_anterior,"€"]}),")"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:"Cancelar"}),e.jsx("button",{onClick:se,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded",children:"Guardar configuración"})]})]})})]})};export{Ue as default};
