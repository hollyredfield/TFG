import{m as o,g as u}from"./mockData-0ElwO_P3.js";const n=(t=500)=>new Promise(e=>setTimeout(e,t)),l=t=>{const e=o.users.find(r=>r.id===t);return e?{id:e.id,nombre_usuario:e.name,avatar_url:e.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name)}&background=0ea5e9&color=fff&size=128`}:null},c={async getCategories(){return await n(300),{data:o.forumCategories.map(t=>({id:t.id,nombre:t.name,descripcion:t.description,icono:t.icon,hilos_count:o.forumThreads.filter(e=>e.categoria_id===t.id).length,mensajes_count:o.forumThreads.filter(e=>e.categoria_id===t.id).reduce((e,r)=>e+o.forumPosts.filter(a=>a.tema_id===r.id).length,0),created_at:t.createdAt,updated_at:t.updatedAt})),error:null}},async getThreads(){return await n(400),{data:o.forumThreads.map(e=>{const r=l(e.user_id),a=o.forumCategories.find(d=>d.id===e.categoria_id),i=o.forumPosts.filter(d=>d.tema_id===e.id).length,s=o.forumVotes.filter(d=>d.item_id===e.id&&d.item_type==="thread").reduce((d,m)=>d+m.vote_value,0);return{...e,profiles:r,foro_categorias:a?{nombre:a.name}:null,replies_count:i,votos_total:s}}).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at)),error:null}},async getThread(t){await n(300);const e=o.forumThreads.find(s=>s.id===t);if(!e)return{data:null,error:{message:"Thread not found"}};const r=l(e.user_id),a=o.forumCategories.find(s=>s.id===e.categoria_id),i=o.forumVotes.filter(s=>s.item_id===e.id&&s.item_type==="thread").reduce((s,d)=>s+d.vote_value,0);return e.vistas=(e.vistas||0)+1,{data:{...e,profiles:r,foro_categorias:a?{nombre:a.name}:null,votos_total:i},error:null}},async getThreadMessages(t){return await n(250),{data:o.forumPosts.filter(r=>r.tema_id===t).map(r=>{const a=o.forumVotes.filter(i=>i.item_id===r.id&&i.item_type==="message").reduce((i,s)=>i+s.vote_value,0);return{...r,profiles:l(r.user_id),votos_total:a}}).sort((r,a)=>new Date(r.created_at)-new Date(a.created_at)),error:null}},async getThreadRepliesCount(t){return await n(100),{count:o.forumPosts.filter(r=>r.tema_id===t).length,error:null}},async createThread(t){await n(400);const e={id:u(),titulo:t.titulo,contenido:t.contenido,categoria_id:t.categoria_id,user_id:t.user_id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),vistas:0,fijado:!1,cerrado:!1};return o.forumThreads.unshift(e),{data:[e],error:null}},async createMessage(t){await n(300);const e={id:u(),tema_id:t.tema_id,user_id:t.user_id,contenido:t.contenido,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};o.forumPosts.push(e);const r=o.forumThreads.find(a=>a.id===t.tema_id);return r&&(r.updated_at=new Date().toISOString()),{error:null}},async deleteThread(t,e){await n(400);const r=o.forumThreads.findIndex(a=>a.id===t&&a.user_id===e);return r===-1?{error:{message:"Thread not found or unauthorized"}}:(o.forumThreads.splice(r,1),o.forumPosts=o.forumPosts.filter(a=>a.tema_id!==t),{error:null})},async deleteMessage(t,e){await n(300);const r=o.forumPosts.findIndex(a=>a.id===t&&a.user_id===e);return r===-1?{error:{message:"Message not found or unauthorized"}}:(o.forumPosts.splice(r,1),{error:null})},async updateThreadViews(t){await n(100);const e=o.forumThreads.find(r=>r.id===t);return e&&(e.vistas=(e.vistas||0)+1),{error:null}},async voteThread(t,e,r){await n(200);const a=o.forumVotes.findIndex(s=>s.item_id===t&&s.user_id===e&&s.item_type==="thread");let i=0;return a!==-1?(i=o.forumVotes[a].vote_value,r===null?o.forumVotes.splice(a,1):(o.forumVotes[a].vote_value=r,o.forumVotes[a].updated_at=new Date().toISOString())):r!==null&&o.forumVotes.push({id:u(),item_id:t,user_id:e,item_type:"thread",vote_value:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),{error:null,oldVote:i,newVote:r}},async voteMessage(t,e,r){await n(200);const a=o.forumVotes.findIndex(s=>s.item_id===t&&s.user_id===e&&s.item_type==="message");let i=0;return a!==-1?(i=o.forumVotes[a].vote_value,r===null?o.forumVotes.splice(a,1):(o.forumVotes[a].vote_value=r,o.forumVotes[a].updated_at=new Date().toISOString())):r!==null&&o.forumVotes.push({id:u(),item_id:t,user_id:e,item_type:"message",vote_value:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),{error:null,oldVote:i,newVote:r}},async getUserVote(t,e,r){await n(100);const a=o.forumVotes.find(i=>i.item_id===t&&i.user_id===e&&i.item_type===r);return{data:a?a.vote_value:null,error:null}},async getVoteCount(t,e){return await n(100),{data:o.forumVotes.filter(i=>i.item_id===t&&i.item_type===e).reduce((i,s)=>i+s.vote_value,0),error:null}}};export{c as f};
