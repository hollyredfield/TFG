import{j as e}from"./ui-BJ93jQot.js";import{a as t,f as E,u as P}from"./vendor-TA_wDYrC.js";import{o as S,p as k,q as F,s as h,r as R,A as z,B as q,C as L}from"./index-BlDEwxQf.js";import"react-toastify";const V=()=>{const[i,b]=t.useState(""),[n,v]=t.useState(""),[l,y]=t.useState(""),[o,c]=t.useState(!1),[d,a]=t.useState(""),[u,m]=t.useState(""),[A,j]=t.useState(null),[p,N]=t.useState("request"),f=E(),x=P();t.useEffect(()=>{const s=x.hash;if(s&&s.includes("type=recovery"))try{const g=new URLSearchParams(s.substring(1)).get("access_token");g&&(j(g),N("reset"))}catch(r){console.error("Error extracting token:",r),a("El enlace de recuperación no es válido. Por favor, solicita otro.")}},[x]);const w=async s=>{if(s.preventDefault(),!i){a("Por favor, introduce tu dirección de correo electrónico");return}c(!0),a("");try{console.log("Solicitando reestablecimiento de contraseña para:",i);const{error:r}=await q(i);r?(console.error("Error al solicitar reestablecimiento:",r),a(r.message)):m("Se ha enviado un correo electrónico con instrucciones para reestablecer tu contraseña. Por favor, revisa tu bandeja de entrada y carpeta de spam.")}catch(r){console.error("Error inesperado:",r),a("Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo más tarde.")}finally{c(!1)}},C=async s=>{if(s.preventDefault(),!n){a("Por favor, introduce tu nueva contraseña");return}if(n!==l){a("Las contraseñas no coinciden");return}if(n.length<6){a("La contraseña debe tener al menos 6 caracteres");return}c(!0),a("");try{console.log("Actualizando contraseña...");const{error:r}=await L(n);r?(console.error("Error al actualizar contraseña:",r),a(r.message)):(m("Tu contraseña ha sido actualizada correctamente"),setTimeout(()=>{f("/login",{state:{message:"Tu contraseña ha sido actualizada. Por favor, inicia sesión con tu nueva contraseña."}})},3e3))}catch(r){console.error("Error inesperado:",r),a("Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo más tarde.")}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black pt-20 pb-12 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gray-800 rounded-lg shadow-xl overflow-hidden border border-gray-700",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 py-4 px-6",children:e.jsx("h1",{className:"text-white text-xl font-bold text-center",children:p==="request"?"Recuperar Contraseña":"Establecer Nueva Contraseña"})}),e.jsxs("div",{className:"p-6",children:[d&&e.jsxs("div",{className:"bg-red-900/30 border border-red-500 text-red-400 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx(S,{className:"mr-2 mt-1 flex-shrink-0"}),e.jsx("span",{children:d})]}),u&&e.jsxs("div",{className:"bg-green-900/30 border border-green-500 text-green-400 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx(k,{className:"mr-2 mt-1 flex-shrink-0"}),e.jsx("span",{children:u})]}),p==="request"?e.jsxs("form",{onSubmit:w,noValidate:!0,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-300 mb-4",children:"Introduce tu dirección de correo electrónico y te enviaremos un enlace para reestablecer tu contraseña."}),e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{className:"text-gray-400"})}),e.jsx("input",{type:"email",id:"email",value:i,onChange:s=>b(s.target.value),autoComplete:"email",className:"block w-full pl-10 pr-3 py-2 bg-gray-700 text-white border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"tu@email.com",disabled:o})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full flex justify-center items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-2 px-4 rounded-md hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-70 transition-colors",children:[o&&e.jsx(h,{className:"animate-spin"}),o?"Enviando...":"Enviar Enlace de Recuperación"]})]}):e.jsxs("form",{onSubmit:C,noValidate:!0,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-300 mb-4",children:"Por favor, introduce tu nueva contraseña."}),e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Nueva Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"text-gray-400"})}),e.jsx("input",{type:"password",id:"password",value:n,onChange:s=>v(s.target.value),autoComplete:"new-password",className:"block w-full pl-10 pr-3 py-2 bg-gray-700 text-white border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Nueva contraseña",disabled:o})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirmar Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(z,{className:"text-gray-400"})}),e.jsx("input",{type:"password",id:"confirm-password",value:l,onChange:s=>y(s.target.value),autoComplete:"new-password",className:"block w-full pl-10 pr-3 py-2 bg-gray-700 text-white border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Confirmar contraseña",disabled:o})]})]}),e.jsxs("button",{type:"submit",disabled:o,className:"w-full flex justify-center items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-2 px-4 rounded-md hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-70 transition-colors",children:[o&&e.jsx(h,{className:"animate-spin"}),o?"Actualizando...":"Actualizar Contraseña"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>f("/login"),className:"text-indigo-400 hover:text-indigo-300 text-sm",children:"Volver a Iniciar Sesión"})})]})]})})};export{V as default};
