import{j as e}from"./ui-BJ93jQot.js";import{a as l,f as C,L as d}from"./vendor-TA_wDYrC.js";import{u as F,p as L,o as R,w as D,q as z,r as N,s as B}from"./index-BlDEwxQf.js";import"react-toastify";const I=()=>{const[a,f]=l.useState({email:"",password:"",confirmPassword:"",username:"",acceptTerms:!1}),[i,h]=l.useState({}),[t,b]=l.useState({}),[n,g]=l.useState(!1),[w,x]=l.useState(""),[u,v]=l.useState(!1),[k,E]=l.useState(""),{register:P}=F();C();const c=o=>{const{name:r,value:s,type:p,checked:j}=o.target;f({...a,[r]:p==="checkbox"?j:s}),i[r]&&y(r,p==="checkbox"?j:s)},m=o=>{const{name:r}=o.target;h({...i,[r]:!0}),y(r,a[r])},y=(o,r)=>{let s={...t};switch(o){case"email":r?/\S+@\S+\.\S+/.test(r)?delete s.email:s.email="El email no es válido":s.email="El email es obligatorio";break;case"password":r?r.length<6?s.password="La contraseña debe tener al menos 6 caracteres":delete s.password:s.password="La contraseña es obligatoria",i.confirmPassword&&(r!==a.confirmPassword?s.confirmPassword="Las contraseñas no coinciden":delete s.confirmPassword);break;case"confirmPassword":r?r!==a.password?s.confirmPassword="Las contraseñas no coinciden":delete s.confirmPassword:s.confirmPassword="Debes confirmar la contraseña";break;case"username":r?r.length<3?s.username="El nombre de usuario debe tener al menos 3 caracteres":/^[a-zA-Z0-9_]+$/.test(r)?delete s.username:s.username="El nombre de usuario solo puede contener letras, números y guiones bajos":s.username="El nombre de usuario es obligatorio";break;case"acceptTerms":r?delete s.acceptTerms:s.acceptTerms="Debes aceptar los términos y condiciones";break}return b(s),Object.keys(s).length===0},S=()=>{let o=!0,r={},s={};return Object.keys(a).forEach(p=>{s[p]=!0}),h(s),a.email?/\S+@\S+\.\S+/.test(a.email)||(r.email="El email no es válido",o=!1):(r.email="El email es obligatorio",o=!1),a.password?a.password.length<6&&(r.password="La contraseña debe tener al menos 6 caracteres",o=!1):(r.password="La contraseña es obligatoria",o=!1),a.confirmPassword?a.password!==a.confirmPassword&&(r.confirmPassword="Las contraseñas no coinciden",o=!1):(r.confirmPassword="Debes confirmar la contraseña",o=!1),a.username?a.username.length<3?(r.username="El nombre de usuario debe tener al menos 3 caracteres",o=!1):/^[a-zA-Z0-9_]+$/.test(a.username)||(r.username="El nombre de usuario solo puede contener letras, números y guiones bajos",o=!1):(r.username="El nombre de usuario es obligatorio",o=!1),a.acceptTerms||(r.acceptTerms="Debes aceptar los términos y condiciones",o=!1),b(r),o},T=async o=>{var r;if(o.preventDefault(),!!S()){g(!0),x("");try{console.log("Intentando registro con:",{email:a.email,username:a.username,passwordLength:((r=a.password)==null?void 0:r.length)||0});const s=await P(a.email,a.password,a.username);console.log("Resultado de registro:",{success:!s.error,hasData:!!s.data,hasMessage:!!s.message}),s.error?(console.error("Error de registro:",s.error),x(s.error.message)):(console.log("Mostrando éxito de registro"),v(!0),E(s.message||"Te hemos enviado un correo de verificación. Por favor, revisa tu bandeja de entrada y haz clic en el enlace para activar tu cuenta."),f({email:"",password:"",confirmPassword:"",username:"",acceptTerms:!1}),setTimeout(()=>{window.scrollTo(0,0)},100))}catch(s){console.error("Error en registro (excepción):",s),x(s.message||"Ha ocurrido un error durante el registro. Por favor, inténtalo de nuevo.")}finally{g(!1)}}};return e.jsx("div",{className:"container-custom py-12",children:e.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-primary py-4 px-6",children:e.jsx("h1",{className:"text-white text-xl font-bold text-center",children:"Crea tu cuenta en CazaOfertas"})}),e.jsxs("div",{className:"p-6",children:["          ",u&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx(L,{className:"mr-2 mt-1 flex-shrink-0 text-green-500",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-lg",children:"¡Registro exitoso!"}),e.jsx("p",{className:"my-2",children:k}),e.jsxs("div",{className:"mt-3 flex flex-col space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-300 rounded",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:"¿No has recibido el correo de verificación?"}),e.jsx(d,{to:"/login",state:{showResendOption:!0,resendEmail:a.email},className:"w-full inline-block text-center text-white bg-primary hover:bg-opacity-90 py-2 px-4 rounded-md text-sm font-medium",children:"Reenviar correo de verificación"})]}),e.jsx("p",{className:"mt-2 text-center",children:e.jsx(d,{to:"/login",className:"text-primary hover:underline",children:"Volver a la página de inicio de sesión"})})]})]})]}),"          ",w&&!u&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx(R,{className:"mr-2 mt-1 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Error al registrarse"}),e.jsx("span",{children:w})]})]}),!u&&e.jsxs("form",{onSubmit:T,noValidate:!0,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de usuario"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"text-gray-400"})}),e.jsx("input",{type:"text",id:"username",name:"username",value:a.username,onChange:c,onBlur:m,className:`block w-full pl-10 pr-3 py-2 border ${t.username?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary`,placeholder:"Tu nombre de usuario",disabled:n})]}),t.username&&i.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.username})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(z,{className:"text-gray-400"})}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:c,onBlur:m,className:`block w-full pl-10 pr-3 py-2 border ${t.email?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary`,placeholder:"tu@email.com",disabled:n})]}),t.email&&i.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.email})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"text-gray-400"})}),"                  ",e.jsx("input",{type:"password",id:"password",name:"password",value:a.password,onChange:c,onBlur:m,className:`block w-full pl-10 pr-3 py-2 border ${t.password?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary`,placeholder:"Mínimo 6 caracteres",disabled:n,autoComplete:"new-password"})]}),t.password&&i.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmar Contraseña"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(N,{className:"text-gray-400"})}),"                  ",e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:a.confirmPassword,onChange:c,onBlur:m,className:`block w-full pl-10 pr-3 py-2 border ${t.confirmPassword?"border-red-500":"border-gray-300"} rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary`,placeholder:"Repite tu contraseña",disabled:n,autoComplete:"new-password"})]}),t.confirmPassword&&i.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.confirmPassword})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"acceptTerms",name:"acceptTerms",type:"checkbox",checked:a.acceptTerms,onChange:c,onBlur:m,className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded",disabled:n})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("label",{htmlFor:"acceptTerms",className:"text-sm text-gray-700",children:["Acepto los ",e.jsx(d,{to:"/terminos",className:"text-primary hover:underline",children:"términos y condiciones"})," y la ",e.jsx(d,{to:"/privacidad",className:"text-primary hover:underline",children:"política de privacidad"})]}),t.acceptTerms&&i.acceptTerms&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.acceptTerms})]})]})}),e.jsxs("button",{type:"submit",disabled:n,className:"w-full flex justify-center items-center gap-2 bg-primary text-white py-2 px-4 rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-70 transition-colors",children:[n&&e.jsx(B,{className:"animate-spin"}),n?"Registrando...":"Crear cuenta"]})]}),!u&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["¿Ya tienes cuenta?"," ",e.jsx(d,{to:"/login",className:"text-primary font-medium hover:underline",children:"Inicia sesión"})]})})]})]})})};export{I as default};
