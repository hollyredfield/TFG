import{j as e}from"./ui-BJ93jQot.js";import{i as L,f as P,a as i,L as m}from"./vendor-TA_wDYrC.js";import{o as y,t as W,c as q,a as R}from"./mockData-0ElwO_P3.js";import{u as z,i as G,_ as H,ad as J,ae as V,g as Y,L as Z,Z as B,af as K,ag as g,c as E}from"./index-BlDEwxQf.js";import{C as Q}from"./CommentSystem-2xyxn-SR.js";import{R as X}from"./RecommendedOffers-CL1_iKmQ.js";import{toast as l}from"react-toastify";import"react-toastify/dist/ReactToastify.css";import"./VoteSystem-C-S41ZoI.js";import"./forumService-DXNLY8bn.js";import"./es-tLztjAZs.js";import"./OfferCard-COSGjkOA.js";import"./ImageWithFallback-BgI07kEf.js";import"./StarRating-DMe66NK6.js";import"./openrouter-DmZqj64n.js";const ee=(o,d)=>{if(!d)return l.error("Debes iniciar sesión para añadir al carrito"),!1;console.log(`Añadiendo ${o.titulo} al carrito`);let s=JSON.parse(localStorage.getItem("cart"))||[];return s.findIndex(x=>x.id===o.id)>-1?l.info(`${o.titulo} ya está en tu carrito.`):(s.push({...o,quantity:1}),localStorage.setItem("cart",JSON.stringify(s)),l.success(`${o.titulo} añadido al carrito!`)),window.dispatchEvent(new CustomEvent("cartUpdated")),!0};let c=JSON.parse(localStorage.getItem("wishlist"))||[];const ue=()=>{const{offerSlug:o}=L();P();const{user:d}=z(),[s,v]=i.useState(null),[x,_]=i.useState(null),[n,D]=i.useState(null),[b,w]=i.useState([]),[p,C]=i.useState(!1),[F,h]=i.useState(!1),[M,j]=i.useState(!1),[N,S]=i.useState(""),[k,O]=i.useState("");i.useEffect(()=>{console.log("[OfferDetail] Hook useEffect ejecutado. offerSlug de URL:",o),console.log("[OfferDetail] Total de ofertas en mockData:",y.length);const t=y.map(r=>r.slug);console.log("[OfferDetail] Slugs disponibles:",t);const a=y.find(r=>r.slug===o);a?(console.log("[OfferDetail] Oferta encontrada:",a),v(a),_(W.find(r=>r.id===a.tiendaId)),D(q.find(r=>r.id===a.categoriaId)),w(R?R.filter(r=>r.ofertaId===a.id):[]),C(c.some(r=>r.id===a.id))):console.error("[OfferDetail] Oferta NO encontrada para el slug:",o)},[o,d]);const T=()=>{s&&ee(s,d)},$=()=>{if(!d){l.error("Debes iniciar sesión para gestionar tu lista de deseos.");return}s&&(c.findIndex(a=>a.id===s.id)>-1?(c=c.filter(a=>a.id!==s.id),l.info(`${s.titulo} eliminado de tu lista de deseos.`)):(c.push(s),l.success(`${s.titulo} añadido a tu lista de deseos!`)),localStorage.setItem("wishlist",JSON.stringify(c)),C(!p),window.dispatchEvent(new CustomEvent("wishlistUpdated")))},u=t=>{if(!s)return;const a=window.location.href,r=`¡Mira esta increíble oferta que encontré en CazaOfertas: ${s.titulo}!`;let f="";switch(t){case"whatsapp":f=`https://api.whatsapp.com/send?text=${encodeURIComponent(r+" "+a)}`;break;case"twitter":f=`https://twitter.com/intent/tweet?url=${encodeURIComponent(a)}&text=${encodeURIComponent(r)}`;break;case"facebook":f=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(a)}`;break;case"copy":navigator.clipboard.writeText(a).then(()=>{l.success("Enlace copiado al portapapeles")}).catch(U=>{l.error("No se pudo copiar el enlace"),console.error("Error al copiar enlace: ",U)}),h(!1);return;default:return}window.open(f,"_blank"),h(!1)},A=t=>{if(t.preventDefault(),!N){l.error("Por favor, selecciona un motivo para el reporte.");return}console.log("Reporte enviado:",{offerId:s.id,reason:N,message:k}),l.success("Oferta reportada. Gracias por tu colaboración."),j(!1),S(""),O("")};if(!s)return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:"Cargando detalles de la oferta..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Si este mensaje persiste, la oferta podría no existir o no estar disponible."}),e.jsxs("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:["(Slug buscado: ",o,")"]})]});const I=s.precio_original>0?Math.round((s.precio_original-s.precio_oferta)/s.precio_original*100):0;return e.jsxs("div",{className:"bg-gray-900 text-gray-200 min-h-screen",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("nav",{className:"text-sm mb-6 text-gray-400",children:[e.jsx(m,{to:"/",className:"hover:text-indigo-400",children:"Inicio"})," /",e.jsx(m,{to:"/ofertas",className:"hover:text-indigo-400",children:" Ofertas"})," /",n&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{to:`/ofertas/categoria/${n.slug}`,className:"hover:text-indigo-400",children:[" ",n.nombre]})," / "]}),e.jsxs("span",{className:"text-gray-500",children:[" ",s.titulo]})]}),e.jsxs("div",{className:"bg-gray-800 shadow-xl rounded-lg overflow-hidden md:flex",children:[e.jsxs("div",{className:"md:w-1/2 relative",children:[e.jsx("img",{src:s.imagen_url||"https://via.placeholder.com/600x400.png?text=Imagen+no+disponible",alt:s.titulo,className:"w-full h-auto object-cover md:h-full max-h-[500px] md:max-h-none"}),I>0&&e.jsxs("span",{className:"absolute top-4 left-4 bg-red-600 text-white text-sm font-semibold px-3 py-1 rounded-full shadow-md",children:[I,"% DESCUENTO"]}),s.tags&&s.tags.includes("REGALO")&&e.jsx("div",{className:"absolute top-2 right-2 bg-purple-500 text-white text-xs font-bold px-2 py-1 rounded",children:"¡INCLUYE REGALO!"})]}),e.jsxs("div",{className:"md:w-1/2 p-6 md:p-8 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold text-white mb-3 leading-tight",children:s.titulo}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-yellow-500",children:Array(Math.round(s.rating||0)).fill("★").join("")}),e.jsxs("span",{className:"text-gray-500",children:["(",s.rating,")"]})]}),e.jsx("p",{className:"text-gray-400 mb-4 text-sm leading-relaxed",children:s.descripcion}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs("span",{className:"text-3xl font-bold text-indigo-400 mr-3",children:[s.precio_oferta.toFixed(2),"€"]}),s.precio_original>s.precio_oferta&&e.jsxs("span",{className:"text-lg text-gray-500 line-through mr-3",children:[s.precio_original.toFixed(2),"€"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 text-sm",children:[n&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"text-indigo-400 mr-2"}),e.jsxs("span",{children:["Categoría: ",e.jsx(m,{to:`/ofertas/categoria/${n.slug}`,className:"text-indigo-400 hover:underline",children:n.nombre})]})]}),x&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"text-indigo-400 mr-2"}),e.jsxs("span",{children:["Tienda: ",e.jsx(m,{to:`/ofertas/tienda/${x.slug}`,className:"text-indigo-400 hover:underline",children:x.nombre})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"text-indigo-400 mr-2"}),e.jsxs("span",{children:["Válido hasta: ",s.fecha_fin||"No especificado"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"text-indigo-400 mr-2"}),e.jsxs("span",{children:[s.comentarios_count||0," Comentarios"]})]}),s.valoracion&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"text-yellow-400 mr-2"}),e.jsxs("span",{children:["Valoración: ",s.valoracion,"/5 (",s.numero_valoraciones||0," votos)"]})]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Etiquetas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(t=>e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:t},t))})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-700",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:T,className:"flex-grow bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center text-lg shadow-md hover:shadow-lg transform hover:scale-105",children:[e.jsx(Z,{className:"mr-2"})," Añadir al Carrito"]}),e.jsxs("button",{onClick:$,className:`flex-grow border-2 ${p?"border-pink-500 bg-pink-500 text-white":"border-gray-600 text-gray-300 hover:bg-gray-700 hover:border-gray-500"} font-semibold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center text-lg shadow-md hover:shadow-lg transform hover:scale-105`,children:[p?e.jsx(B,{className:"mr-2"}):e.jsx(K,{className:"mr-2"}),p?"En Lista de Deseos":"Guardar Oferta"]})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[e.jsxs("button",{onClick:()=>h(!0),className:"text-gray-400 hover:text-indigo-400 transition-colors flex items-center text-sm",children:[e.jsx(g,{className:"mr-1"})," Compartir"]}),e.jsxs("button",{onClick:()=>j(!0),className:"text-gray-400 hover:text-red-500 transition-colors flex items-center text-sm",children:[e.jsx(E,{className:"mr-1"})," Reportar Oferta"]})]})]})]})]}),e.jsxs("div",{className:"mt-10 bg-gray-800 shadow-lg rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Descripción Completa"}),e.jsx("div",{className:"prose prose-invert max-w-none text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:s.descripcion_larga||"<p>No hay descripción detallada disponible para esta oferta.</p>"}})]}),e.jsxs("div",{className:"mt-10 bg-gray-800 shadow-lg rounded-lg p-6 md:p-8",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-white mb-4",children:["Comentarios (",b.length,")"]}),b.length>0?e.jsx("ul",{className:"space-y-6",children:b.map(t=>e.jsxs("li",{className:"p-4 bg-gray-700 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("img",{src:t.usuario_avatar||"https://via.placeholder.com/40.png?text=User",alt:t.usuario_nombre,className:"w-10 h-10 rounded-full mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-400",children:t.usuario_nombre}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.fecha).toLocaleDateString()})]})]}),e.jsx("p",{className:"text-gray-300 leading-relaxed",children:t.texto})]},t.id))}):e.jsx("p",{className:"text-gray-400",children:"Sé el primero en comentar esta oferta."}),e.jsx(Q,{productId:s.id,productType:"offer"})]}),e.jsx("h2",{className:"text-2xl font-bold mb-4 mt-10",children:"Te puede interesar"}),e.jsx(X,{currentOfferId:s.id,categoryId:s.categoriaId,storeId:s.tiendaId})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Compartir Oferta"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>u("whatsapp"),className:"bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg flex items-center justify-center",children:[e.jsx(g,{className:"mr-2"})," WhatsApp"]}),e.jsxs("button",{onClick:()=>u("twitter"),className:"bg-blue-400 hover:bg-blue-500 text-white py-3 rounded-lg flex items-center justify-center",children:[e.jsx(g,{className:"mr-2"})," Twitter"]}),e.jsxs("button",{onClick:()=>u("facebook"),className:"bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg flex items-center justify-center",children:[e.jsx(g,{className:"mr-2"})," Facebook"]}),e.jsxs("button",{onClick:()=>u("copy"),className:"bg-gray-600 hover:bg-gray-500 text-white py-3 rounded-lg flex items-center justify-center",children:[e.jsx(g,{className:"mr-2"})," Copiar Enlace"]})]}),e.jsx("button",{onClick:()=>h(!1),className:"mt-6 w-full bg-gray-700 hover:bg-gray-600 text-gray-300 py-2 rounded-lg",children:"Cancelar"})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("form",{onSubmit:A,className:"bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Reportar Oferta"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:["Estás reportando: ",e.jsx("strong",{className:"text-indigo-400",children:s.titulo})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Ayúdanos a mantener la comunidad segura y las ofertas actualizadas."}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"reportReason",className:"block text-sm font-medium text-gray-300 mb-1",children:["Motivo del reporte ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"reportReason",value:N,onChange:t=>S(t.target.value),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-200",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un motivo..."}),e.jsx("option",{value:"expirada",children:"Oferta expirada / No disponible"}),e.jsx("option",{value:"precio_incorrecto",children:"Precio incorrecto / Engañoso"}),e.jsx("option",{value:"enlace_roto",children:"Enlace roto o incorrecto"}),e.jsx("option",{value:"contenido_inapropiado",children:"Contenido inapropiado / Spam"}),e.jsx("option",{value:"otro",children:"Otro (especifica abajo)"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"reportMessage",className:"block text-sm font-medium text-gray-300 mb-1",children:"Mensaje adicional (opcional)"}),e.jsx("textarea",{id:"reportMessage",rows:"3",value:k,onChange:t=>O(t.target.value),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-gray-200 placeholder-gray-500",placeholder:"Proporciona más detalles si es necesario..."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-gray-200 rounded-md transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors flex items-center",children:[e.jsx(E,{className:"mr-2"})," Enviar Reporte"]})]})]})})]})};export{ue as default};
