import{j as s}from"./ui-BJ93jQot.js";import{a as l}from"./vendor-TA_wDYrC.js";import{u as p,aU as E,aV as y,V}from"./index-BlDEwxQf.js";import{f as i}from"./forumService-DXNLY8bn.js";const C=({itemId:r,itemType:o,initialVotes:v=0,initialUserVote:b=null})=>{const{user:a,isAuthenticated:f}=p(),[u,m]=l.useState(v),[n,x]=l.useState(b),[d,h]=l.useState(!1);l.useEffect(()=>{if(f&&a&&r){const c=async()=>{try{const{data:e}=await i.getUserVote(r,a.id,o);x(e)}catch(e){console.error("Error fetching user vote:",e)}},t=async()=>{try{const{data:e}=await i.getVoteCount(r,o);m(e||0)}catch(e){console.error("Error fetching vote count:",e)}};c(),t()}},[f,a,r,o]);const g=async c=>{if(!f){V.error("Debes iniciar sesión para votar");return}h(!0);try{const t=n===c?null:c;let e;if(o==="thread")e=await i.voteThread(r,a.id,t);else if(o==="message")e=await i.voteMessage(r,a.id,t);else throw new Error("Tipo de item no válido");if(e.error)throw e.error;const w=(t||0)-(e.oldVote||0);m(j=>j+w),x(t)}catch(t){console.error("Error al votar:",t),V.error("Error al procesar tu voto")}finally{h(!1)}};return s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{disabled:d,onClick:()=>g(1),className:`flex items-center mr-2 ${n===1?"text-green-600":"text-gray-500 hover:text-green-600"}`,"aria-label":"Me gusta",children:s.jsx(E,{className:`transition-transform ${n===1?"transform scale-110":""}`})}),s.jsx("span",{className:`font-medium text-sm ${u>0?"text-green-600":u<0?"text-red-600":"text-gray-500"}`,children:u}),s.jsx("button",{disabled:d,onClick:()=>g(-1),className:`flex items-center ml-2 ${n===-1?"text-red-600":"text-gray-500 hover:text-red-600"}`,"aria-label":"No me gusta",children:s.jsx(y,{className:`transition-transform ${n===-1?"transform scale-110":""}`})})]})};export{C as V};
