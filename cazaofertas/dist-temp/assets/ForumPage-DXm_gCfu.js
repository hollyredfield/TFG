import{j as e}from"./ui-BJ93jQot.js";import{a as t,f as k}from"./vendor-TA_wDYrC.js";import{u as E,aH as S,a3 as _,w as A,aW as F,aI as L,an as D}from"./index-BlDEwxQf.js";import{f as u}from"./forumService-DXNLY8bn.js";import{L as z}from"./Loading-DhytMDVs.js";import{f as q,e as P}from"./es-tLztjAZs.js";import"react-toastify";import"./mockData-0ElwO_P3.js";const G=()=>{const[h,f]=t.useState([]),[g,j]=t.useState([]),[y,N]=t.useState(!0),[o,b]=t.useState(""),[i,d]=t.useState("all"),n=k(),{user:V,isAuthenticated:v}=E();t.useEffect(()=>{(async()=>{try{const{data:a,error:r}=await u.getCategories();r?console.error("Error fetching categories:",r):j(a||[]);const{data:c,error:l}=await u.getThreads();l?console.error("Error fetching threads:",l):f(c||[])}catch(a){console.error("Error in forum fetch:",a)}finally{N(!1)}})()},[]);const w=()=>{v?n("/foro/nuevo"):n("/login",{state:{from:"/foro"}})},C=s=>{n(`/foro/tema/${s}`)},m=h.filter(s=>(i==="all"||s.categoria_id===i)&&(s.titulo.toLowerCase().includes(o.toLowerCase())||s.contenido.toLowerCase().includes(o.toLowerCase()))),T=s=>q(new Date(s),{addSuffix:!0,locale:P});return y?e.jsx(z,{}):e.jsxs("div",{className:"container-custom py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Foro de CazaOfertas"}),e.jsx("p",{className:"text-gray-600",children:"Comparte y discute sobre todo tipo de ofertas y productos"})]}),e.jsxs("button",{onClick:w,className:"mt-4 md:mt-0 bg-primary text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(S,{className:"mr-2"})," Nuevo tema"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary",placeholder:"Buscar temas...",value:o,onChange:s=>b(s.target.value)})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("select",{value:i,onChange:s=>d(s.target.value),className:"w-full md:w-auto pl-4 pr-8 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary bg-white",children:[e.jsx("option",{value:"all",children:"Todas las categorías"}),g.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})})]}),m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No hay temas que coincidan con tu búsqueda"}),i!=="all"&&e.jsx("button",{className:"mt-4 text-primary hover:underline",onClick:()=>d("all"),children:"Ver todas las categorías"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tema"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Autor"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estadísticas"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Última actualización"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(s=>{var a,r,c,l,x,p;return e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>C(s.id),children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:s.titulo}),e.jsxs("div",{className:"md:hidden mt-1 flex items-center text-xs text-gray-500",children:[e.jsxs("span",{className:"inline-flex items-center mr-3",children:[e.jsx(A,{className:"mr-1",size:10})," ",((a=s.profiles)==null?void 0:a.nombre_usuario)||"Anónimo"]}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded",children:(r=s.foro_categorias)==null?void 0:r.nombre})]})]})}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4",children:e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:(c=s.foro_categorias)==null?void 0:c.nombre})}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:e.jsx("img",{className:"h-8 w-8 rounded-full object-cover",src:((l=s.profiles)==null?void 0:l.avatar_url)||"https://via.placeholder.com/40",alt:((x=s.profiles)==null?void 0:x.nombre_usuario)||"Avatar"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-gray-900",children:((p=s.profiles)==null?void 0:p.nombre_usuario)||"Anónimo"})})]})}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4 text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(F,{className:"mr-1 text-gray-400"})," ",s.replies_count]}),e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(L,{className:"mr-1 text-gray-400"})," ",s.vistas||0]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"mr-2 text-gray-400"}),e.jsx("span",{children:T(s.updated_at||s.created_at)})]})})]},s.id)})})]})})]})]})};export{G as default};
