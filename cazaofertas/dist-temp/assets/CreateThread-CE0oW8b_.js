import{j as e}from"./ui-BJ93jQot.js";import{a as t,f as w}from"./vendor-TA_wDYrC.js";import{u as E,aT as S,o as k,V as l}from"./index-BlDEwxQf.js";import{f as h}from"./forumService-DXNLY8bn.js";import{R as T}from"./quill.snow-C9f5Rqf5.js";import"react-toastify";import"./mockData-0ElwO_P3.js";const L=()=>{const[i,b]=t.useState(""),[c,p]=t.useState(""),[n,g]=t.useState(""),[v,j]=t.useState([]),[m,u]=t.useState(!1),[x,d]=t.useState(null),o=w(),{user:y,isAuthenticated:f}=E();t.useEffect(()=>{f||o("/login",{state:{from:"/foro/nuevo"}}),(async()=>{try{const{data:a,error:s}=await h.getCategories();if(s)throw s;j(a||[])}catch(a){console.error("Error al cargar categorías:",a),d("No se pudieron cargar las categorías. Por favor, inténtalo de nuevo.")}})()},[f,o]);const N=async r=>{if(r.preventDefault(),!i.trim()){l.error("El título no puede estar vacío");return}if(!c.trim()){l.error("El contenido no puede estar vacío");return}if(!n){l.error("Debes seleccionar una categoría");return}u(!0),d(null);try{const{data:a,error:s}=await h.createThread({titulo:i,contenido:c,categoria_id:n,user_id:y.id});if(s)throw s;l.success("Tema creado correctamente"),o(`/foro/tema/${a[0].id}`)}catch(a){console.error("Error al crear tema:",a),d("No se pudo crear el tema. Por favor, inténtalo de nuevo."),l.error("Error al crear el tema")}finally{u(!1)}},C={toolbar:[["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]};return e.jsxs("div",{className:"container-custom py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>o("/foro"),className:"flex items-center text-primary hover:underline",children:[e.jsx(S,{className:"mr-1"})," Volver al foro"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Crear nuevo tema"}),x&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:x})]})}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"titulo",className:"block text-gray-700 font-medium mb-2",children:"Título"}),e.jsx("input",{type:"text",id:"titulo",value:i,onChange:r=>b(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary",placeholder:"Escribe un título descriptivo para tu tema",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"categoria",className:"block text-gray-700 font-medium mb-2",children:"Categoría"}),e.jsxs("select",{id:"categoria",value:n,onChange:r=>g(r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary focus:border-primary",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar categoría"}),"              ",v.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"contenido",className:"block text-gray-700 font-medium mb-2",children:"Contenido"}),e.jsx(T,{theme:"snow",modules:C,value:c,onChange:p,className:"bg-white",placeholder:"Describe tu tema con detalle..."})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>o("/foro"),className:"px-4 py-2 text-gray-600 mr-2",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md disabled:bg-gray-400",disabled:m,children:m?"Creando...":"Crear tema"})]})]})]})]})};export{L as default};
