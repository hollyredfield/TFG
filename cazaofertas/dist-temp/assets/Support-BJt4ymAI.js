import{j as e}from"./ui-BJ93jQot.js";import{h as $,a as c,L as C}from"./vendor-TA_wDYrC.js";import{u as q,a_ as L,V as b,o as M,ao as U,Q as E,aH as S,q as V,s as T,a$ as z,aT as H,b0 as O,aq as B}from"./index-BlDEwxQf.js";import{N as R}from"./notificationService-BzK7A9Fv.js";import"react-toastify";const X=()=>{const{user:l}=q(),[y]=$(),[x,i]=c.useState("tickets"),[N,_]=c.useState([]),[a,n]=c.useState(null),[g,u]=c.useState(!1),[o,v]=c.useState({subject:"",message:"",department:"general",priority:"normal",orderRef:y.get("ref")==="order"?y.get("id"):""}),[j,F]=c.useState(""),[f,d]=c.useState(!1);c.useEffect(()=>{l&&(w(),y.get("ref")==="order"&&(d(!0),i("new")))},[l,y]);const w=async()=>{if(l){u(!0);try{const{data:r,success:t,error:s}=await L(l.id);if(t&&r)_(r),r.length===1&&!a&&!f&&n(r[0]);else throw new Error((s==null?void 0:s.message)||"Error al cargar los tickets")}catch(r){console.error("Error cargando tickets:",r),b.error("No se pudieron cargar los tickets de soporte")}finally{u(!1)}}},A=async r=>{if(r.preventDefault(),!!l){u(!0);try{const t={userId:l.id,subject:o.subject||"Consulta general",message:o.message,department:o.department,priority:o.priority},{data:s,success:m,error:p}=await B(t);if(m&&s)b.success("Ticket de soporte creado correctamente"),await R.createNotification({userId:l.id,type:"SUPPORT_TICKET_CREATED",title:"Ticket de soporte creado",message:`Tu ticket "${s.asunto}" ha sido creado y será revisado en breve.`,data:{ticket_id:s.id,ticket_subject:s.asunto,priority:s.prioridad}}),v({subject:"",message:"",department:"general",priority:"normal",orderRef:""}),d(!1),await w(),n(s),i("tickets");else throw new Error((p==null?void 0:p.message)||"Error al crear el ticket")}catch(t){console.error("Error creando ticket:",t),b.error("No se pudo crear el ticket de soporte")}finally{u(!1)}}},P=async r=>{if(r.preventDefault(),!(!l||!a||!j.trim())){u(!0);try{const t={message:j,userId:l.id},{success:s,error:m}=await O(a.id,t);if(s){b.success("Respuesta enviada correctamente"),await R.createNotification({userId:l.id,type:"SUPPORT_TICKET_UPDATED",title:"Actualización de ticket de soporte",message:`Has añadido una nueva respuesta a tu ticket "${a.asunto}".`,data:{ticket_id:a.id,ticket_subject:a.asunto,status:a.estado}}),F(""),await w();const p=N.find(I=>I.id===a.id);n(p)}else throw new Error((m==null?void 0:m.message)||"Error al enviar la respuesta")}catch(t){console.error("Error enviando respuesta:",t),b.error("No se pudo enviar la respuesta")}finally{u(!1)}}},h=r=>{const{name:t,value:s}=r.target;v(m=>({...m,[t]:s}))},D=r=>{switch(r){case"abierto":return{label:"Abierto",color:"bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-400"};case"en_proceso":return{label:"En Proceso",color:"bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-400"};case"esperando_respuesta":return{label:"Esperando Respuesta",color:"bg-yellow-100 dark:bg-yellow-900/40 text-yellow-800 dark:text-yellow-400"};case"resuelto":return{label:"Resuelto",color:"bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-400"};case"cerrado":return{label:"Cerrado",color:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-400"};default:return{label:r,color:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-400"}}},k=r=>new Date(r).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return l?e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Soporte al Cliente"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"¿Tienes alguna pregunta o problema? Estamos aquí para ayudarte."})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(C,{to:"/preguntas-frecuentes",className:"button-modern button-secondary inline-flex items-center",children:[e.jsx(U,{className:"mr-2"}),"Ver preguntas frecuentes"]})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>{i("tickets"),d(!1)},className:`
              whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm
              ${x==="tickets"?"border-primary text-primary dark:border-primary-light dark:text-primary-light":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:border-gray-300 dark:hover:text-gray-300 dark:hover:border-gray-600"}
            `,children:[e.jsx(E,{className:"inline mr-2"})," Mis Tickets"]}),e.jsxs("button",{onClick:()=>{i("new"),d(!0),n(null)},className:`
              whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm
              ${x==="new"?"border-primary text-primary dark:border-primary-light dark:text-primary-light":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:border-gray-300 dark:hover:text-gray-300 dark:hover:border-gray-600"}
            `,children:[e.jsx(S,{className:"inline mr-2"})," Nuevo Ticket"]}),e.jsxs("button",{onClick:()=>{i("contact"),d(!1),n(null)},className:`
              whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm
              ${x==="contact"?"border-primary text-primary dark:border-primary-light dark:text-primary-light":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 hover:border-gray-300 dark:hover:text-gray-300 dark:hover:border-gray-600"}
            `,children:[e.jsx(V,{className:"inline mr-2"})," Contacto"]})]})}),g&&!f&&!a&&e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(T,{className:"animate-spin text-4xl text-primary"})}),x==="tickets"&&!f&&e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Mis Tickets"}),e.jsx("button",{onClick:()=>{i("new"),d(!0),n(null)},className:"text-primary dark:text-primary-light hover:text-primary-dark dark:hover:text-primary-light/80",children:e.jsx(S,{})})]}),N.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(E,{className:"mx-auto text-4xl text-gray-300 dark:text-gray-600 mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No tienes tickets de soporte"}),e.jsx("button",{onClick:()=>{i("new"),d(!0)},className:"button-modern button-primary text-sm",children:"Crear nuevo ticket"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:N.map(r=>{const{label:t,color:s}=D(r.estado);return e.jsxs("button",{onClick:()=>{n(r),d(!1)},className:`w-full text-left p-4 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors ${(a==null?void 0:a.id)===r.id?"bg-gray-50 dark:bg-gray-700/30":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.asunto}),e.jsx("span",{className:`ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${s}`,children:t})]}),"                        ",e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1 truncate",children:r.mensaje?r.mensaje.slice(0,60)+"...":"No message content"}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:k(r.created_at)})]},r.id)})})]})}),e.jsx("div",{className:"md:col-span-2",children:a?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:a.asunto}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Creado el ",k(a.created_at)]})]}),e.jsx("div",{children:(()=>{const{label:r,color:t}=D(a.estado);return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t}`,children:r})})()})]})}),e.jsxs("div",{className:"p-6 h-full flex flex-col",children:[e.jsx("div",{className:"mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Tú"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:k(a.created_at)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line",children:a.mensaje})]})}),e.jsx("div",{className:"space-y-6 mb-6 flex-grow",children:a.estado==="en_proceso"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-400",children:"Soporte CazaOfertas"}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-500",children:[k(new Date(Date.now()-864e5))," "]})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Hemos recibido tu consulta y estamos trabajando para ayudarte lo antes posible. Un miembro de nuestro equipo te responderá en breve."})]})}),e.jsxs("div",{className:"mt-auto",children:[a.estado!=="cerrado"&&a.estado!=="resuelto"&&e.jsxs("form",{onSubmit:P,className:"mt-4",children:[e.jsxs("label",{htmlFor:"response-message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(z,{className:"mr-2 inline"}),"Añadir respuesta"]}),e.jsx("textarea",{id:"response-message",rows:"3",value:j,onChange:r=>F(r.target.value),placeholder:"Escribe tu respuesta...",className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary mb-3",required:!0}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:g||!j.trim(),className:"button-modern button-primary",children:g?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2"})," Enviando..."]}):e.jsx(e.Fragment,{children:"Enviar respuesta"})})})]}),(a.estado==="cerrado"||a.estado==="resuelto")&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center",children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-3",children:["Este ticket está ",a.estado==="cerrado"?"cerrado":"resuelto"," y no se pueden añadir más respuestas."]}),e.jsx("button",{onClick:()=>{i("new"),d(!0),n(null),v(r=>({...r,subject:`Re: ${a.asunto}`}))},className:"button-modern button-secondary",children:"Crear nuevo ticket"})]})]})]})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft h-full flex flex-col items-center justify-center p-10 text-center",children:[e.jsx(E,{className:"text-5xl text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white mb-2",children:"Selecciona un ticket"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 max-w-md",children:"Selecciona un ticket de soporte de la lista para ver los detalles y responder, o crea uno nuevo si necesitas ayuda."}),e.jsxs("button",{onClick:()=>{i("new"),d(!0)},className:"button-modern button-primary",children:[e.jsx(S,{className:"mr-2"})," Crear nuevo ticket"]})]})})]}),f&&x==="new"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>{d(!1),i("tickets")},className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 mr-3",children:e.jsx(H,{})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Crear nuevo ticket de soporte"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Asunto"}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:o.subject,onChange:h,placeholder:"Describe brevemente tu consulta",className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Departamento"}),e.jsxs("select",{id:"department",name:"department",value:o.department,onChange:h,className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"ventas",children:"Ventas"}),e.jsx("option",{value:"tecnico",children:"Soporte técnico"}),e.jsx("option",{value:"facturacion",children:"Facturación"}),e.jsx("option",{value:"envios",children:"Envíos y logística"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prioridad"}),e.jsxs("select",{id:"priority",name:"priority",value:o.priority,onChange:h,className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary",children:[e.jsx("option",{value:"baja",children:"Baja"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"urgente",children:"Urgente"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"orderRef",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Referencia del pedido (si aplica)"}),e.jsx("input",{type:"text",id:"orderRef",name:"orderRef",value:o.orderRef,onChange:h,placeholder:"Número de pedido (opcional)",className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mensaje"}),e.jsx("textarea",{id:"message",name:"message",rows:"6",value:o.message,onChange:h,placeholder:"Describe tu problema o consulta con detalles para que podamos ayudarte mejor",className:"block w-full rounded-lg border-gray-300 dark:border-gray-600 shadow-sm dark:bg-gray-700 dark:text-white focus:border-primary focus:ring-primary",required:!0})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:g||!o.message.trim(),className:"button-modern button-primary",children:g?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2"})," Enviando..."]}):e.jsx(e.Fragment,{children:"Enviar ticket"})})})]})]})}),x==="contact"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Información de contacto"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Horario de atención"}),e.jsxs("ul",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Lunes a Viernes"}),e.jsx("span",{className:"font-medium",children:"9:00 - 18:00"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Sábados"}),e.jsx("span",{className:"font-medium",children:"10:00 - 14:00"})]}),e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:"Domingos y festivos"}),e.jsx("span",{className:"font-medium",children:"Cerrado"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Teléfono de atención"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:e.jsx("a",{href:"tel:+34911234567",className:"text-primary dark:text-primary-light",children:"+34 911 23 45 67"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Correo electrónico"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:e.jsx("a",{href:"mailto:soporte@cazaofertas.com",className:"text-primary dark:text-primary-light",children:"soporte@cazaofertas.com"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Dirección"}),e.jsxs("address",{className:"not-italic text-gray-700 dark:text-gray-300",children:["CazaOfertas S.L.",e.jsx("br",{}),"Calle del Comercio, 21",e.jsx("br",{}),"28001 Madrid, España"]})]})]})]})]})})]}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"mr-2"}),e.jsx("p",{children:"Debes iniciar sesión para acceder al soporte"})]})}),e.jsxs("div",{className:"flex space-x-4 mt-6",children:[e.jsx(C,{to:"/login",className:"button-modern button-primary",children:"Iniciar sesión"}),e.jsx(C,{to:"/",className:"button-modern button-secondary",children:"Volver al inicio"})]})]})};export{X as default};
