import{j as e}from"./ui-BJ93jQot.js";import{a as i,L as n}from"./vendor-TA_wDYrC.js";import{u as N,aH as g,o as v,i as b,_ as k,aI as w,b as E,aG as F,ai as O,a2 as _,O as p,V as f}from"./index-BlDEwxQf.js";import"react-toastify";const P=()=>{const[s,m]=i.useState([]),[y,d]=i.useState(!0),[u,c]=i.useState(null),[t,o]=i.useState("published"),{user:x}=N();i.useEffect(()=>{async function r(){if(!x){d(!1);return}try{d(!0),c(null);const{data:a,error:l}=await p.from("ofertas").select(`
            *,
            categorias(*),
            tiendas(*),
            comentarios_count:comentarios(count)
          `).eq("user_id",x.id).order("created_at",{ascending:!1});if(l)throw l;m(a||[])}catch(a){console.error("Error cargando ofertas del usuario:",a),c("No se pudieron cargar tus ofertas. Por favor, inténtalo de nuevo.")}finally{d(!1)}}r()},[x]);const j=async r=>{if(confirm("¿Estás seguro de que quieres eliminar esta oferta? Esta acción no se puede deshacer."))try{d(!0);const{error:a}=await p.from("ofertas").delete().eq("id",r);if(a)throw a;m(s.filter(l=>l.id!==r)),f.success("Oferta eliminada correctamente")}catch(a){console.error("Error eliminando oferta:",a),c("No se pudo eliminar la oferta. Por favor, inténtalo de nuevo."),f.error("No se pudo eliminar la oferta")}finally{d(!1)}},h=(()=>{switch(t){case"published":return s.filter(r=>r.estado==="activa");case"draft":return s.filter(r=>r.estado==="borrador");case"expired":return s.filter(r=>r.estado==="expirada"||new Date(r.fecha_fin)<new Date);default:return s}})();return y&&s.length===0?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx("div",{className:"animate-spin h-10 w-10 border-3 border-primary rounded-full border-t-transparent"})}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Mis Ofertas"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Gestiona todas las ofertas que has publicado en la plataforma"})]}),e.jsx("div",{className:"mt-4 lg:mt-0",children:e.jsxs(n,{to:"/crear-oferta",className:"button-modern button-primary inline-flex items-center",children:[e.jsx(g,{className:"mr-2"})," Publicar nueva oferta"]})})]}),u&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg mb-6 flex items-start",children:[e.jsx(v,{className:"mt-1 mr-2 flex-shrink-0"}),e.jsx("p",{children:u})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-soft overflow-hidden mb-8",children:[e.jsx("div",{className:"border-b dark:border-gray-700",children:e.jsxs("nav",{className:"flex flex-wrap",children:[e.jsx("button",{onClick:()=>o("published"),className:`px-6 py-4 text-sm font-medium ${t==="published"?"border-b-2 border-primary text-primary dark:text-primary-light":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Publicadas"}),e.jsx("button",{onClick:()=>o("draft"),className:`px-6 py-4 text-sm font-medium ${t==="draft"?"border-b-2 border-primary text-primary dark:text-primary-light":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Borradores"}),e.jsx("button",{onClick:()=>o("expired"),className:`px-6 py-4 text-sm font-medium ${t==="expired"?"border-b-2 border-primary text-primary dark:text-primary-light":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Expiradas"})]})}),h.length===0?e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(b,{className:"text-3xl text-gray-400 dark:text-gray-500"})}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:["No tienes ofertas ",t==="published"?"publicadas":t==="draft"?"en borrador":"expiradas"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 max-w-md mx-auto",children:t==="published"?"Comienza a publicar ofertas para que otros usuarios puedan beneficiarse de ellas.":t==="draft"?"Guarda ofertas como borrador mientras las preparas para publicar.":"Aquí aparecerán las ofertas que hayan llegado a su fecha de expiración."}),e.jsxs(n,{to:"/crear-oferta",className:"button-modern button-primary",children:[e.jsx(g,{className:"mr-2"})," Crear una oferta"]})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(r=>{var a;return e.jsx("div",{className:"p-6 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start",children:[e.jsx("div",{className:"mb-4 md:mb-0 md:mr-6 flex-shrink-0",children:r.imagen_url?e.jsx("img",{src:r.imagen_url,alt:r.titulo,className:"w-full md:w-32 h-32 object-cover rounded-lg shadow-sm"}):e.jsx("div",{className:"w-full md:w-32 h-32 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx(b,{className:"text-gray-400 text-3xl"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:r.titulo}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(k,{className:"mr-1"}),e.jsx("span",{children:((a=r.tiendas)==null?void 0:a.nombre)||"Tienda no especificada"}),r.categorias&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:r.categorias.nombre})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2 mt-1",children:[r.estado==="activa"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-400 rounded",children:"Activa"}),r.estado==="borrador"&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 rounded",children:"Borrador"}),r.estado==="expirada"||new Date(r.fecha_fin)<new Date?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-400 rounded",children:"Expirada"}):null]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-3",children:r.descripcion}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(w,{className:"mr-1"}),e.jsxs("span",{children:[r.vista_count||0," vistas"]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx(E,{className:"mr-1"}),e.jsxs("span",{children:[r.comentarios_count||0," comentarios"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4 sm:mt-0",children:[e.jsxs(n,{to:`/oferta/${r.id}`,className:"px-3 py-1.5 text-sm bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white rounded hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Ver"]}),e.jsxs(n,{to:`/editar-oferta/${r.id}`,className:"px-3 py-1.5 text-sm bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-400 rounded hover:bg-blue-200 dark:hover:bg-blue-900/60 flex items-center",children:[e.jsx(O,{className:"mr-1 h-3 w-3"}),"Editar"]}),e.jsxs("button",{onClick:()=>j(r.id),className:"px-3 py-1.5 text-sm bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/60 flex items-center",children:[e.jsx(_,{className:"mr-1 h-3 w-3"}),"Eliminar"]})]})]})]})]})},r.id)})})]})]})};export{P as default};
