import{j as e}from"./ui-BJ93jQot.js";import{a,f as B}from"./vendor-TA_wDYrC.js";import{u as L,D as T,i as $,E as M,G as A,l as J,s as V,H,I as z,J as K,V as Q}from"./index-BlDEwxQf.js";import{m as F}from"./mockData-0ElwO_P3.js";import{N as W}from"./notificationService-BzK7A9Fv.js";import"react-toastify";const se=()=>{const[o,S]=a.useState(""),[p,C]=a.useState(""),[d,P]=a.useState(""),[c,I]=a.useState(""),[m,D]=a.useState(""),[i,E]=a.useState(""),[u,h]=a.useState(null),[b,y]=a.useState(!1),[j,v]=a.useState(""),[N,w]=a.useState(""),[g,_]=a.useState(!0),{user:x}=L(),O=B(),{createNotification:G}=T(),R=r=>{const t=r.target.files[0];if(t){h(t);const s=new FileReader;s.onloadend=()=>{w(s.result)},s.readAsDataURL(t)}},U=async r=>{var t;r.preventDefault(),y(!0),v("");try{if(!o||!d||!c||!i)throw new Error("Por favor completa todos los campos obligatorios");let s="";if(u){const{data:l,error:n}=await z(u,`offers/${Date.now()}_${u.name}`);if(n)throw n;s=l.path}const q={title:o,description:p,url:d,current_price:parseFloat(c),original_price:m?parseFloat(m):null,category_id:parseInt(i),image_url:s||"",user_id:x.id,notify_followers:g},{data:f,error:k}=await K(q);if(k)throw k;if(await W.notifyOfferCreated(x.id,{id:f.id,title:o}),g&&f){const l=((t=F.categorias.find(n=>n.id===parseInt(i)))==null?void 0:t.nombre)||"General";await G({userId:x.id,type:"OFFER",title:"Nueva oferta publicada",message:`Tu oferta "${o}" ha sido publicada en la categoría ${l}.`,data:{offer_id:f.id,category_id:parseInt(i),category_name:l}})}Q.success("¡Oferta publicada con éxito!"),O("/ofertas/recientes")}catch(s){console.error("Error al publicar oferta:",s),v(s.message),y(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black py-12 px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 py-6 px-6",children:e.jsx("h1",{className:"text-2xl font-bold text-white text-center",children:"Publicar nueva oferta"})}),e.jsxs("form",{onSubmit:U,className:"p-6 space-y-6",children:[j&&e.jsx("div",{className:"bg-red-900/30 border border-red-500 text-red-400 px-4 py-3 rounded",children:j}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Título de la oferta *"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"text-gray-400"})}),e.jsx("input",{type:"text",value:o,onChange:r=>S(r.target.value),className:"bg-gray-700 block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-md text-gray-200 placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",placeholder:"Ej: MacBook Pro M2 con 256GB",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URL de la oferta *"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"text-gray-400"})}),e.jsx("input",{type:"url",value:d,onChange:r=>P(r.target.value),className:"bg-gray-700 block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-md text-gray-200 placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",placeholder:"https://...",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Precio actual *"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-400",children:"€"})}),e.jsx("input",{type:"number",value:c,onChange:r=>I(r.target.value),className:"bg-gray-700 block w-full pl-8 pr-3 py-2 border border-gray-600 rounded-md text-gray-200 placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",placeholder:"0.00",step:"0.01",min:"0",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Precio original"}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-400",children:"€"})}),e.jsx("input",{type:"number",value:m,onChange:r=>D(r.target.value),className:"bg-gray-700 block w-full pl-8 pr-3 py-2 border border-gray-600 rounded-md text-gray-200 placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",placeholder:"0.00",step:"0.01",min:"0"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Categoría *"}),e.jsxs("select",{className:"block w-full px-4 py-3 mt-1 text-base border border-gray-300 rounded-md shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500",value:i,onChange:r=>E(r.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),F.categorias.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Descripción"}),e.jsx("textarea",{value:p,onChange:r=>C(r.target.value),rows:"4",className:"bg-gray-700 block w-full px-3 py-2 border border-gray-600 rounded-md text-gray-200 placeholder-gray-400 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",placeholder:"Describe los detalles de la oferta..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Imagen de la oferta"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-600 border-dashed rounded-lg",children:e.jsx("div",{className:"space-y-1 text-center",children:N?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N,alt:"Preview",className:"mx-auto h-32 w-auto rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>{h(null),w("")},className:"absolute top-0 right-0 -mt-2 -mr-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:"✕"})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-400",children:[e.jsxs("label",{className:"relative cursor-pointer bg-gray-700 rounded-md font-medium text-indigo-400 hover:text-indigo-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500",children:[e.jsx("span",{children:"Subir imagen"}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",onChange:R})]}),e.jsx("p",{className:"pl-1",children:"o arrastra y suelta"})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"PNG, JPG, GIF hasta 10MB"})]})})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"notify-followers",name:"notify-followers",type:"checkbox",checked:g,onChange:r=>_(r.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-500 rounded bg-gray-700"}),e.jsxs("label",{htmlFor:"notify-followers",className:"ml-2 flex items-center text-sm text-gray-300",children:[e.jsx(J,{className:"text-indigo-400 mr-2"}),"Notificar a seguidores sobre esta oferta"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-md font-medium hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"animate-spin -ml-1 mr-2 h-5 w-5"}),"Publicando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"-ml-1 mr-2 h-5 w-5"}),"Publicar oferta"]})})})]})]})})})};export{se as default};
