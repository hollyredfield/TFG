import{j as e}from"./ui-BJ93jQot.js";import{a,f as V,u as O,L as S}from"./vendor-TA_wDYrC.js";import{u as T,o as A,p as $,q,r as D,s as k,t as H,v as U}from"./index-BlDEwxQf.js";import"react-toastify";const K=()=>{var E;const[i,v]=a.useState(""),[m,R]=a.useState(""),[C,P]=a.useState(!1),[c,o]=a.useState(""),[n,j]=a.useState(!1),[y,u]=a.useState(""),[x,N]=a.useState(!1),[g,l]=a.useState(""),[f,p]=a.useState(""),{setUser:F,isAuthenticated:w}=T(),h=V(),t=O();a.useEffect(()=>{var s;if((s=t.state)!=null&&s.message){u(t.state.message);const r=setTimeout(()=>{u("")},5e3);return()=>clearTimeout(r)}},[t.state]),a.useEffect(()=>{var s;if(w){const r=((s=t.state)==null?void 0:s.from)||"/";h(r)}},[w,h,t.state]),a.useEffect(()=>{var s,r;(s=t.state)!=null&&s.showResendOption&&((r=t.state)!=null&&r.resendEmail)&&(v(t.state.resendEmail),o("Por favor verifica tu email primero"))},[t.state]);const I=()=>{let s=!0;return l(""),p(""),o(""),i?/\S+@\S+\.\S+/.test(i)||(l("Por favor, introduce un email válido"),s=!1):(l("El email es obligatorio"),s=!1),m||(p("La contraseña es obligatoria"),s=!1),s},L=async s=>{var r;if(s.preventDefault(),!!I()){j(!0),o("");try{console.log("Intentando iniciar sesión...");const{data:d,error:b}=await H(i,m);b?(console.log("Error en inicio de sesión:",b.message),o(b.message)):(r=d==null?void 0:d.session)!=null&&r.user&&(F(d.session.user),h("/"))}catch(d){console.error("Error en login:",d),o("Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo.")}finally{j(!1)}}},M=async()=>{if(!i){l("Por favor, introduce tu dirección de email para reenviar el correo de verificación.");return}N(!0),l("");try{console.log("Enviando correo de verificación a:",i);const{data:s,error:r}=await U(i);r?(console.error("Error al reenviar correo:",r),o(r.message)):(console.log("Respuesta de reenvío:",s),u("Se ha enviado un nuevo correo de verificación. Por favor, revisa tu bandeja de entrada y carpeta de spam. Puede tardar unos minutos en llegar."),o(""))}catch(s){console.error("Error al reenviar correo de verificación:",s),o("No se pudo reenviar el correo de verificación. Por favor, inténtalo de nuevo más tarde.")}finally{N(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black pt-20 pb-12 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto bg-gray-800 rounded-lg shadow-xl overflow-hidden border border-gray-700",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 py-4 px-6",children:e.jsx("h1",{className:"text-white text-xl font-bold text-center",children:"Iniciar Sesión"})}),e.jsxs("div",{className:"p-6",children:[c&&e.jsxs("div",{className:"bg-red-900/30 border border-red-500 text-red-400 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx(A,{className:"mr-2 mt-1 flex-shrink-0"}),e.jsx("span",{children:c})]}),y&&e.jsxs("div",{className:"bg-green-900/30 border border-green-500 text-green-400 px-4 py-3 rounded mb-4 flex items-start",children:[e.jsx($,{className:"mr-2 mt-1 flex-shrink-0"}),e.jsx("span",{children:y})]}),e.jsxs("form",{onSubmit:L,noValidate:!0,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(q,{className:"text-gray-400"})}),e.jsx("input",{type:"email",id:"email",value:i,onChange:s=>{v(s.target.value),l("")},autoComplete:"email",className:`block w-full pl-10 pr-3 py-2 bg-gray-700 text-white border ${g?"border-red-500":"border-gray-600"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`,placeholder:"tu@email.com",disabled:n})]}),g&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Contraseña"}),e.jsx(S,{to:"/recuperar-password",className:"text-sm text-indigo-400 hover:text-indigo-300",children:"¿Olvidaste la contraseña?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"text-gray-400"})}),e.jsx("input",{type:"password",id:"password",value:m,onChange:s=>{R(s.target.value),p("")},autoComplete:"current-password",className:`block w-full pl-10 pr-3 py-2 bg-gray-700 text-white border ${f?"border-red-500":"border-gray-600"} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`,placeholder:"Tu contraseña",disabled:n})]}),f&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:f})]}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("input",{id:"remember-me",type:"checkbox",checked:C,onChange:s=>P(s.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-600 rounded bg-gray-700",disabled:n}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-300",children:"Recordarme"})]}),e.jsxs("button",{type:"submit",disabled:n,className:"w-full flex justify-center items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-2 px-4 rounded-md hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-70 transition-colors",children:[n&&e.jsx(k,{className:"animate-spin"}),n?"Iniciando sesión...":"Iniciar Sesión"]}),(c&&c.includes("verificado")||((E=t.state)==null?void 0:E.showResendOption))&&e.jsxs("div",{className:"mt-4 p-3 bg-indigo-900/30 border border-indigo-500 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"¿No has recibido el correo de verificación o ha expirado?"}),e.jsxs("button",{type:"button",disabled:x,className:"w-full flex justify-center items-center gap-2 text-white bg-indigo-600 hover:bg-indigo-700 py-2 px-4 rounded-md text-sm font-medium disabled:opacity-70",onClick:M,children:[x&&e.jsx(k,{className:"animate-spin"}),x?"Enviando...":"Reenviar correo de verificación"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Si no encuentras el correo, revisa tu carpeta de spam o correo no deseado. Los correos pueden tardar hasta 5 minutos en entregarse."})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["¿No tienes cuenta?"," ",e.jsx(S,{to:"/registro",className:"text-indigo-400 font-medium hover:text-indigo-300",children:"Regístrate ahora"})]})})]})]})})};export{K as default};
